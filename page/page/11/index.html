
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Matt Aimonetti</title>
    <meta name="author" content="Matt Aimonetti">

    
    <meta name="description" content="Ruby, Rack and CouchDB = Lots of Awesomeness Over the weekend, I spent some time working on a Ruby + Rack +CouchDB project. Three technologies that &hellip;">
    
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />

    <link href="/Matt-Aimonetti/atom.xml" rel="alternate" title="Matt Aimonetti" type="application/atom+xml">
    <link rel="canonical" href="http://mattetti.github.com/Matt-Aimonetti">
    <link href="/Matt-Aimonetti/favicon.png" rel="shortcut icon">
    <link href="/Matt-Aimonetti/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30927742-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header><div id='meta' class='inner'>
  <div id="matt-aimonetti" itemscope itemtype="http://data-vocabulary.org/Person">
    <img class="photo left" src="/Matt-Aimonetti/images/matt_aimonetti.jpg" />
    <h1 class="left"><a itemprop="name" href="/Matt-Aimonetti/">Matt Aimonetti</a></h1>
    <br>
    <ul class='left'>
      <li><a href='http://www.linkedin.com/in/mattaimonetti'>Software Architecture</a> at <span itemprop="affiliation">LivingSocial</span></li>
      <li><a href='http://www.oreillynet.com/pub/au/4385'>Author</a> at <span itemprop="affiliation">O'Reilly</span></li>
      <li>Open-source <a href="/articles/archives">evangelist</a></li>
      <li><a href="https://github.com/mattetti">Web engineer</a></li>
    </ul>
  <nav class="menu left"><ul class="main">
	<li><a href="/Matt-Aimonetti/">Articles</a></li>
	<li><a href="/Matt-Aimonetti/posts/archives">Archives</a></li>
</ul>
</nav>
  <div class="right">
    <form class="search right" action="http://google.com/search" method="get">
      <input class="left" type="text" name="q" results="0">
      <input type="hidden" name="q" value="site:mattetti.github.com/Matt-Aimonetti">
    </form>
    <div class="social right">
      
      
      <a class="google" rel='me' href="https://plus.google.com/101114877505962271216?rel=author" title="Google+">Google+</a>
      
      
      <a class="twitter" rel='me' href="http://twitter.com/merbist" title="Twitter">Twitter</a>
      
      
      <a class="github" rel='me' href="https://github.com/mattetti" title="GitHub">GitHub</a>
      
      
      
      <a class="linkedin" rel='me' href="http://www.linkedin.com/in/mattaimonetti" title="Linkedin">Linkedin</a>
      
      
      <a class="rss" rel='me' href="/Matt-Aimonetti/atom.xml" title="RSS">RSS</a>
      
    </div>
  </div>
</div>

</header>
	
<!--
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/merbist">merbist</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/Matt-Aimonetti/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('merbist', 0, false);
	})(jQuery);
</script>
-->


	<div id="content" class="inner">


    <article class="post">
    <h1 class="title entry-title"><a href="/Matt-Aimonetti/posts/2009/07/27/ruby-rack-and-couchdb-lots-of-awesomeness/">Ruby, Rack and CouchDB = Lots of Awesomeness</a></h1>
    <div class="entry">
        <p>Over the weekend, I spent some time working on a Ruby + Rack +CouchDB project. Three technologies that I know quite well but that I never put to work together at the same time, at least not directly.  Let&#8217;s call this Part I.</p>

<p>Before we get started, let me introduce each component:</p>

<ul>
<li><p><a href="http://en.wikipedia.org/wiki/Ruby%20%28programming%20language%29">Ruby</a> : if you are reading this blog, you more than likely know at least a little bit about, what I consider, one of the most enjoyable programming language out there. It&#8217;s also a very flexible language that lets us do some interesting things. I could have chosen Python to do the same project but that&#8217;s a whole different topic. For this project we will do something Ruby excels at: reopening existing classes and injecting more code.</p></li>
<li><p><a href="http://rack.rubyforge.org/">Rack</a>: a webserver interface written in Ruby and inspired by <a href="http://www.wsgi.org/wsgi/">Python&#8217;s WSGI</a>. Basically, it&#8217;s a defined API to interact between webservers and web frameworks. It&#8217;s used by most common Ruby web frameworks, from Sinatra to Rails (btw, Rails3 is going to be even more Rack-focused than it already is). So, very simply put, the webserver receives a request, passes it to Rack, that converts it, passes it to your web framework and the web framework sends a response in the expected format (more on Rack later).</p></li>
<li><p><a href="http://couchdb.apache.org/">CouchDB</a>: Apache&#8217;s document-oriented database. RESTful API, schema-less, written in Erlang with built-in support for map/reduce. For this project, I&#8217;m using <a href="http://github.com/mattetti/couchrest">CouchRest</a>, a Ruby wrapper for Couch.</p></li>
</ul>


<h2>Goal: Log Couch requests and analyze data</h2>

<p>Let&#8217;s say we have a Rails, Sinatra or Merb application and we are using CouchRest (maybe we are using CouchRest and ActiveRecord, but let&#8217;s ignore that for now).</p>

<p>Everything works fine but we would like to profile our app a little and maybe optimize the DB usage. The default framework loggers don&#8217;t support Couch. The easy way would be to tail the Couch logs or look at the logs in <a href="http://janl.github.com/couchdbx/">CouchDBX</a>. Now, while that works, we can&#8217;t really see what DB calls are made per action, so it makes any optimization work a bit tedious. (Note that Rails3 will have some better conventions for logging, making things even easier)</p>

<p>So, let&#8217;s see how to fix that. Let&#8217;s start by looking at Rack.</p>

<h2>Rack Middleware</h2>

<p>Instead of hacking a web framework specific solution, let&#8217;s use Rack. Rack is dead simple, you just need to write a class that has a <em>call</em> method.
In our case, we don&#8217;t care about modifying the response, we just want to instrument our app. We just want our middleware to be transparent and let our webserver deal with it normally.</p>

<p>Here we go &#8230; that wasn&#8217;t hard, was it? We keep the application reference in the @app variable when a new instance of the middleware is created. Then when the middleware is called, we just call the rest of the chain and pretend nothing happened.</p>

<p>As you can see, we just added some logging info around the request. Let&#8217;s do one better and save the logs in CouchDB:</p>

<p>Again, nothing complicated. In our rackup file we defined which Couch database to use and we passed it to our middleware (we change our initialize method signature to take the DB).
Finally, instead of printing out the logs, we are saving them to the database.</p>

<p>W00t! At this point all our requests have been saved in the DB with all the data there, ready to be manipulated by some map/reduce views we will write. For the record, you might want to use the bulk_save approach in CouchDB which will wait for X amount of records to save them in the DB all at once. Couch also let&#8217;s you send new documents, but only save it to the DB every X documents or X seconds.</p>

<p><img src="http://img.skitch.com/20090726-ebmpgjtrc6x8239ia69kmri1rt.jpg" alt="" /></p>

<p>As you can see, our document contains the timestamps and the full environment as a hash.</p>

<p>All of that is nice, but even though we get a lot of information, we could not actually see any of the DB calls made in each request. Let&#8217;s fix that and inject our logger in CouchRest (you could apply the same approach to any adapter).</p>

<p>Let&#8217;s reopen the HTTP Abstraction layer class used by CouchRest and inject some instrumentation:</p>

<p>Again, nothing fancy, we are just opening the module, reopening the methods and wrapping our code around the <em>super</em> call (for those who don&#8217;t know, <em>super</em> calls the original method).</p>

<p>This is all for Part I. In Part II, we&#8217;ll see how to process the logs and make all that data useful.</p>

<p>By the way, if you make it to <a href="http://www.railssummit.com.br/">RailsSummit</a>, I will be giving a talk on Rails3 and the new exciting stuff you will be able to do including Rack based stuff, CouchDB, MongoDB, new DataMapper etc..</p>

<p><a href="http://railssummit.com.br/"><img src="http://railssummit.com.br/images/banners/en_souPalestrante_210x60.jpg" alt="" /></a></p>

        
        
    </div>
    <div class="meta">
        <div class="date updated">








  


<time datetime="2009-07-27T13:49:20+02:00" pubdate data-updated="true">Jul 27<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/Matt-Aimonetti/articles/categories/misc/'>Misc</a>, <a class='category' href='/Matt-Aimonetti/articles/categories/tutorial/'>Tutorial</a>, <a class='category' href='/Matt-Aimonetti/articles/categories/merb/'>merb</a>, <a class='category' href='/Matt-Aimonetti/articles/categories/rails/'>rails</a>, <a class='category' href='/Matt-Aimonetti/articles/categories/ruby/'>ruby</a>
  
</div>

</div>
        <div class='vcard author'><small>By <span class='fn'>Matt Aimonetti</span></small></div>
        
    </div>

</article>


    <article class="post">
    <h1 class="title entry-title"><a href="/Matt-Aimonetti/posts/2009/07/13/ruby-authentication-of-couchdb-requests/">Ruby Authentication of CouchDB Requests</a></h1>
    <div class="entry">
        <p><a href="http://couchdb.apache.org/">CouchDB</a> is an awesome technology. I&#8217;m lucky enough to work on quite a big project where we decided to switch from MySQL to Couch for various reasons.</p>

<p>One of the many things I like with Couch is that it handles attachments and can replicate them as well as serve them for you using the <a href="http://en.wikipedia.org/wiki/Erlang%20%28programming%20language%29">Erlang</a> based builtin webserver. (you can load balance your dbs and do some other really cool stuff)</p>

<p>Let&#8217;s take a use case. Let&#8217;s imagine that you have a web app with logged in users. Every user can have their own avatar.</p>

<p>No big deal, you get the user to upload his/her avatar to your app and add it to the user document in the database. To serve it from the database, you just need to create a proxy in nginx/apache and redirect the virtual avatar url to the protected DB making sure the request is a GET request.</p>

<p>Add to that a caching solution like <a href="http://varnish.projects.linpro.no/">varnish</a> or <a href="http://www.igvita.com/2008/02/11/nginx-and-memcached-a-400-boost/">memcached module for nginx</a> and all your db goodies get cached and served by the cache (server/client) until they get modified.</p>

<p>Now, the problem is when you want to serve authorized attachments. Let&#8217;s imagine that we want to let our users upload private files, files that should be accessible only by the owner or users designated by the owner.</p>

<p>In this case, a simple <a href="http://en.wikipedia.org/wiki/Nginx">nginx</a> rewrite wouldn&#8217;t work. We need to authorize attachment requests. Here is a cool way of doing that using nginx and merb&#8217;s router. (Expect Rails3 router to do the same).</p>

<p>Let&#8217;s start by setting up nginx and create a proxy for couchdb:</p>

<p>Now that this is done, we are going to use Merb&#8217;s awesome router to handle the incoming requests. The cool part of this is that we won&#8217;t be dispatching requests so, going through the router is almost free. (check on the Merb router benchmarks for more info).  Let&#8217;s edit our router and set a special route for our assets.</p>

<p>We are using a deferred route which gets executed instead of dispatching the request.</p>

<p>If the attachment route is being matched then we are checking what environment we are currently running in. If we are in production or staging environment then we are sending back a rack response to the webserver. The response is just a forward to the proper couchdb document behind the proxy. Of course, before allowing that to happen, we could authenticate the logged in user, log the request and do a couple of other things. You have full access to your models from the router, so authenticating a session isn&#8217;t a big deal. You could even create temporarily urls like AWS s3 does.</p>

<p>If we are not in production or staging mode, then just redirect the request to couch since we assume you have access to the local db. This way, your asset urls will be working in production and dev. In real life, you&#8217;ll want to apply the authorization before choosing how to deliver the document/attachment tho as you want it work the same way in development and production.</p>

        
        
    </div>
    <div class="meta">
        <div class="date updated">








  


<time datetime="2009-07-13T13:00:13+02:00" pubdate data-updated="true">Jul 13<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/Matt-Aimonetti/articles/categories/misc/'>Misc</a>
  
</div>

</div>
        <div class='vcard author'><small>By <span class='fn'>Matt Aimonetti</span></small></div>
        
    </div>

</article>


    <article class="post">
    <h1 class="title entry-title"><a href="/Matt-Aimonetti/posts/2009/07/12/compiled-hello-world-with-macruby/">Compiled Hello World With MacRuby</a></h1>
    <div class="entry">
        <p>To celebrate the amazing <a href="http://lists.macosforge.org/pipermail/macruby-devel/2009-July/002062.html">work being done by Laurent Sansonetti on MacRuby</a> here is a hello world using the new <a href="http://en.wikipedia.org/wiki/LLVM">LLVM</a> based compiler.
<code>
$ echo "p ARGV.join(' ').upcase" &gt; hello_world.rb
$ macrubyc hello_world.rb -o macruby_says
$ ./macruby_says hello world
"HELLO WORLD"
</code></p>

<p>Note that to achieve this result, you need to be using the experimental branch of MacRuby and have LLVM installed. (check the <a href="http://svn.macosforge.org/repository/ruby/MacRuby/branches/experimental/README.rdoc">readme</a> available in MacRuby&#8217;s repo).</p>

<p>Let&#8217;s quickly look at what we just did.
We created a single line ruby script that takes the passed arguments, joins them and print them uppercase.
Then, we compiled our script into a <a href="http://en.wikipedia.org/wiki/Mach-O">Mach-O</a> object file and produce an executable.</p>

<p>Here is an extract from Laurent&#8217;s latest status report:</p>

<blockquote><p>Produced executables embed all the compiled Ruby code as well as MacRuby, statically.
It can be distributed as is and does not depend on anything MacRuby or LLVM at runtime.
The Ruby source code is compiled into native machine code (same process as we do at runtime with the JIT compiler), so it&#8217;s also a good way to obfuscate the source code.
The final binary looks like an Objective-C binary (except that it&#8217;s larger)</p></blockquote>

<p>Don&#8217;t expect to compile Rails just yet, it&#8217;s still in a preliminary stage.</p>

<p>The final release you should let you pick one of the 2 compilation modes:</p>

<ul>
<li><strong>normal mode</strong>: full ruby specs, compile down to machine code and use LLVM at runtime. (recommended for desktop/server apps)</li>
<li><strong>full mode</strong>: no full ruby spec support, no runtime code generation, no LLVM. (&#8220;very light application and/or if the environment does not support runtime code generation&#8221; (<em>hint-hint)</em>)</li>
</ul>


<p>As you can see, <a href="http://macruby.org">MacRuby</a> is moving forward and the experimental branch should soon move to trunk.</p>

        
        
    </div>
    <div class="meta">
        <div class="date updated">








  


<time datetime="2009-07-12T11:53:53+02:00" pubdate data-updated="true">Jul 12<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/Matt-Aimonetti/articles/categories/misc/'>Misc</a>, <a class='category' href='/Matt-Aimonetti/articles/categories/macruby/'>macruby</a>
  
</div>

</div>
        <div class='vcard author'><small>By <span class='fn'>Matt Aimonetti</span></small></div>
        
    </div>

</article>


    <article class="post">
    <h1 class="title entry-title"><a href="/Matt-Aimonetti/posts/2009/05/27/macruby-changing-the-ruby-ecosystem/">MacRuby, Changing the Ruby Ecosystem</a></h1>
    <div class="entry">
        <h3>What&#8217;s MacRuby?</h3>

<p><a href="http://www.macruby.org/">MacRuby</a> is an Apple-sponsored, open source, full Ruby implementation on top of <a href="http://en.wikipedia.org/wiki/Objective-C">Objective-C</a> runtime. In other words, whatever code runs on Ruby 1.9, should/will run on MacRuby. Yes, you read correctly, MacRuby can/will be able to run all your Ruby code. That means that eventually you will even be able to run your <a href="http://en.wikipedia.org/wiki/Ruby%20on%20Rails">Rails</a>/<a href="http://en.wikipedia.org/wiki/Sinatra%20%28software%29">Sinatra</a>/new-sexy-ruby-framework app on MacRuby.</p>

<p>Unlike <a href="http://en.wikipedia.org/wiki/RubyCocoa">RubyCocoa</a>, MacRuby is not a bridge, it is a full implementation of the Ruby language on top of Apple&#8217;s Objective-C runtime. Taking a huge shortcut, MacRuby implements the Ruby syntax by aliasing it to the Obj-C language counterpart. A Ruby string instance is really in fact, an instance of <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableString_Class/Reference/Reference.html">NSMutableString</a>. This is obviously transparent for you as a developer since you have the same Ruby API, but it also means that MacRuby can make use of the various Objective-C&#8217;s goodies such as native threads, <a href="http://en.wikipedia.org/wiki/Objective-c#Garbage_collection"> garbage collector</a> in the background as well as the runtime performance.</p>

<p>On top of that, you have full access to the Obj-C API from your Ruby code. (tip: in macirb, try &#8220;my string&#8221;.methods(true, true).sort to see the available Ruby + Objective-C methods on your String instance)  The reason why having access to Objective-C is important is because it gives you the possibility to write native <a href="http://en.wikipedia.org/wiki/Cocoa%20%28API%29">Cocoa</a>apps using Ruby. For those who don&#8217;t know Cocoa, is a set of APIs for MacOSX development.</p>

<p>However, note that even though, the Cocoa support is almost complete and stable, MacRuby is still in development, especially on the Ruby side of things.</p>

<h3>What is it not?</h3>

<ul>
<li><p><a href="http://www.macruby.org/">MacRuby</a> is not a fork of Ruby. Full <a href="http://rubyspec.org/">rubyspec</a> compliance is expected! It&#8217;s true that MacRuby supports smalltalk/Obj-C method selectors so it might be considered a language superset.</p></li>
<li><p>MacRuby is not limited to the OSX platform. All its dependencies are open source and could possibly be compiled for other POSIX-based systems such as Linux.. (not done yet)</p></li>
<li><p>Even if MacRuby&#8217;s primary goal is to allow you to write efficient Cocoa apps, it does not mean that MacRuby is limited to that.</p></li>
<li><p>MacRuby doesn&#8217;t require you to learn Objective-C in order to develop Cocoa apps. (you just need to understand Obj-C selectors)</p></li>
</ul>


<h3>What&#8217;s coming up?</h3>

<p>The current version of MacRuby (today being the 27th of May 2009) is version 0.4. You might have heard of things about MacRuby crazy performance, <a href="http://en.wikipedia.org/wiki/Low%20Level%20Virtual%20Machine">LLVM</a>, <a href="http://en.wikipedia.org/wiki/AOT%20compiler">AOT compilation</a><a href="http://en.wikipedia.org/wiki/AOT%20compiler">AOT compilation</a> etc&#8230; This is all happening in the &#8216;experimental&#8217; branch.</p>

<p>What&#8217;s going on is that up to MacRuby 0.5, MR was  using YARV (Ruby 1.9 interpreter) on top of Obj-C and which obviously limited MacRuby&#8217;s  to YARV&#8217;s performance. After RubyConf 2008, Laurent Sansonetti, MacRuby&#8217;s lead developer, decided to try removing YARV to only keep its <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a> and experiment with using <a href="http://en.wikipedia.org/wiki/Llvm">LLVM</a> instead of the 1.9 interpreter.</p>

<p>This switch turned out to be very promising and was noticed right away by influential people such as <a href="http://antoniocangiano.com/2009/03/29/why-macruby-matters/">IBM&#8217;s Antonio Cangiano</a>. Since then, performance and compatibility have increased. Laurent even started working on an Ahead Of Time (AOT) compiler: <a href="http://pastie.org/485095">http://pastie.org/485095</a> What&#8217;s really impressive is that in this specific example (Fibonacci sequence), <strong>MacRuby&#8217;s compiled code is faster than Objective-C!</strong> But let&#8217;s not jump the gun. First this is a very very early prototype and most of your apps won&#8217;t be using Fib. sequences ;) In this case, MacRuby&#8217;s recursive method dispatch is faster but again, this is just a proof of concept and even though MacRuby is getting close to Obj-C speed, it&#8217;s still far from matching Obj-C&#8217;s impressive performance.</p>

<p>What this basically means is that you will be able to compile your Ruby code down to binary code. Imagine, taking your Rails app and compiling it down to a binary file that you can just push to your server :) But really, what&#8217;s almost more important is that Ruby will get closer to Objective-C&#8217;s speed.</p>

<h3>Why will MacRuby change the Ruby ecosystem?</h3>

<p>As a web developer, getting better performance is great. But Ruby is already fast enough. Rails is faster than any PHP framework out there and when doing Merb&#8217;s benchmarks we proved that Ruby for the web can definitely be fast.</p>

<p>Now if MacRuby ends up running 3-7X faster than Ruby 1.9 (no one can tell for sure), existing Ruby developers will certainly be really pleased but it will probably affect more people outside of our community than within. Let&#8217;s face it, our community isn&#8217;t that big but it&#8217;s growing fast and people are mainly coming to Ruby for its web frameworks. But Ruby has much more than that to offer. Desktop applications, <a href="http://www.railsenvy.com/2009/5/11/rubystein-ruby-meets-wolfenstein">video games</a>, scientific computation and even embedded apps. Apple is betting on Ruby probably because of the fact that they see the potential in the language itself.</p>

<p>Would people still use Java if Ruby is as fast/faster than Java? Probably! Would they think about using Ruby for their next project? I would certainly hope so!</p>

<p>Ruby is viral, it&#8217;s such a great language, people who have started using it are having a hard time going back to what they used before. But to spread the &#8216;love&#8217;, we need to give people the opportunity to discover why Ruby is so great and to do that, we need to make sure Ruby is relevant to them. By making Ruby a realistic option to write desktop/mobile applications, we are targeting a new audience. An experienced audience which will be able to bring a new perspective to our ecosystem and help it grow.</p>

<p>Of course, MacRuby isn&#8217;t the only implementation out there trying to do that. JRuby and IronRuby are also very interesting projects. My take on it, is that MacRuby will be able to change things because of its new approach and potential community. It will more than likely be the first Ruby implementation compiling down to binary code, it will more than likely be the fastest implementation and it will more than likely draw a different type of developer.</p>

<p>Does it mean that <a href="http://jruby.codehaus.org/">JRuby</a>, <a href="http://www.ironruby.net/">IronRuby</a>, <a href="http://www.infoq.com/news/2009/04/ruby-on-sap">BlueRuby</a> will be useless? Absolutely not! Matz is the first one to encourage diversity and I agree that this is a great way to move forward. These projects solve different problems and all have pros and cons, but they also all share a similar goal: making Ruby a better and more popular language outside of its original community. JRuby, IronRuby and MacRuby bring Ruby to the respective Java, .net and Cocoa communities, and indirectly bring fresh developers to Ruby. These implementations are critical in the way they actually bridge existing communities and in the end, all Rubyists will benefit from it. Also, even though MacRuby and IronRuby are in active development, JRuby is the only mature alternative to MRI/YARV at this point and it proved that Ruby can coexist in a different community as well as contribute a lot of interesting things back to the Ruby community.</p>

<p>To summarize, I see tremendous potential in MacRuby. There is the obvious technical aspect of the implementation, but also the indirect affect MacRuby could have on our community. I believe that MacRuby is an agent of change and will help bringing more diversity to our community. It will change mentalities and push Ruby to places where it&#8217;s being struggling to make a mark. I can see the so-called &#8220;Enterprise&#8221; people looking at Ruby differently. I also think that MacRuby has the potential to be at the origin of a new type of hybrid application, mixing desktop/mobile/distributed applications with centralized web applications. Why not dream of p2p applications/games using a subset of Rails to communicate between each other and with a central server?</p>

<p><a href="http://macruby.org"><img src="http://merbist.com/wp-content/uploads/2009/05/macruby-site.jpg" alt="macruby-site" /></a></p>

<p>If you are interested in learning more about MacRuby, check the list of <a href="http://www.macruby.org/documentation.html">resources available on the MacRuby site</a>.</p>

<p>Rich Kilmer and I are also working on a documentation application for Cocoa and <a href="http://www.macruby.org/hotcocoa.html">HotCocoa</a> as well as a MVC framework for writing Cocoa apps using HotCocoa (HotCocoa is a thin, idiomatic Ruby layer that sits above Cocoa and other frameworks).</p>

<p>Make sure to keep an eye on <a href="http://twitter.com/macruby">@macruby</a> and the <a href="http://macruby.org">MacRuby website</a> if you want to keep track of the latest news.</p>

        
        
    </div>
    <div class="meta">
        <div class="date updated">








  


<time datetime="2009-05-27T12:32:05+02:00" pubdate data-updated="true">May 27<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/Matt-Aimonetti/articles/categories/macruby/'>macruby</a>, <a class='category' href='/Matt-Aimonetti/articles/categories/ruby/'>ruby</a>
  
</div>

</div>
        <div class='vcard author'><small>By <span class='fn'>Matt Aimonetti</span></small></div>
        
    </div>

</article>


    <article class="post">
    <h1 class="title entry-title"><a href="/Matt-Aimonetti/posts/2009/05/17/couchdb-with-couchrest-in-5-minutes/">CouchDB With CouchRest in 5 Minutes</a></h1>
    <div class="entry">
        <p>The other night, during our monthly <a href="http://sdruby.com">SDRuby meetup</a>, lots of people were very interested in learning more about CouchDB and Ruby. I tried to show what Couch was all about but I didn&#8217;t have time to show how to use CouchDB with Ruby.
Here is me trying to do that in 10 minutes or less. I&#8217;ll assume you don&#8217;t have CouchDB installed.</p>

<p>Install CouchDB, if you are on MacOSX, you are in luck, download and unzip the standalone package called <a href="http://janl.github.com/couchdbx/">CouchDBX</a>.
That&#8217;s it you have couch ready to go, press play and play with the web interface.</p>

<p>Next, let&#8217;s write a quick script. Let&#8217;s say we want to write a script that manages your contacts.</p>

<p>First, let&#8217;s install CouchRest:</p>

<p><code>
$ sudo gem install couchrest
</code></p>

<p>Now, let&#8217;s open a new file and write our script.</p>

<p>In line 4 and 5 we are just setting up the server(by default, localhost is being used). If the database doesn&#8217;t exist, it will get created.</p>

<p><code>SERVER    = CouchRest.new</code></p>

<p><code>DB           = SERVER.database!('contact-manager')</code></p>

<p>Then, we define your &#8216;model&#8217;, we set the default database to use and define a list of properties. Properties are not required, but they generate getters and setters for you. They are also used to set default values and validate your model.  Line 11 shows how to use an alias that will provider a getter and a setter for the property name and the alias name:</p>

<p><code>property :last_name, :alias =&gt; :family_name</code></p>

<p>Line 14 does something that might seem strange at first. We are casting the address property as an instance of the Address class.  Here is what the implementation of the Address class could look like:</p>

<p>Address is just an instance of Hash with some extra methods provided by the CouchRest::CastedModel module. (If you wonder why it&#8217;s called CastedModel instead of the more grammatically correct CastModel, the answer is simple: I suck at English grammar :p )</p>

<p>So here is a quick example of how to use a &#8216;CastedModel&#8217;:</p>

<p>That&#8217;s part of what&#8217;s great with CouchDB, you don&#8217;t need to worry too much about storage. Just define your properties, cast to models if needed and save everything as a document.</p>

<p>For more examples checkout the <a href="http://github.com/mattetti/couchrest/tree/a4e6713aeb04721604553bb03475b11912a6e1ff/spec/fixtures/more">CouchRest spec fixtures</a> and the <a href="http://github.com/mattetti/couchrest/tree/85079a54d98ea90ecbab31cba319f0971904e9a6/examples">examples</a>.</p>

<p>To learn more about couchdb, read the (free) online draft of the <a href="http://books.couchdb.org/relax/">CouchDB book</a> and of course you probably should read the <a href="http://github.com/mattetti/couchrest">CouchRest source on GitHub</a>.</p>

        
        
    </div>
    <div class="meta">
        <div class="date updated">








  


<time datetime="2009-05-17T21:31:14+02:00" pubdate data-updated="true">May 17<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/Matt-Aimonetti/articles/categories/ruby/'>ruby</a>
  
</div>

</div>
        <div class='vcard author'><small>By <span class='fn'>Matt Aimonetti</span></small></div>
        
    </div>

</article>

<nav id="pagenavi">
    
        <a href="/Matt-Aimonetti/page/page/10/" class="prev">Prev</a>
    
    
        <a href="/Matt-Aimonetti/page/page/12/" class="next">Next</a>
    
    <a href="/Matt-Aimonetti/articles/archives" class="center">Archives</a>
</nav>
</div>
	<footer class="inner"><div id='copyright-notice'>Copyright &copy; 2012 Matt Aimonetti</div>
</footer>
	<script src="/Matt-Aimonetti/javascripts/jquery.fancybox.pack.js"></script>
<script src="/Matt-Aimonetti/javascripts/slash.js"></script>




</body>
</html>
